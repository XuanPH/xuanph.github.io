__NUXT_JSONP__("/trien-khai-docker-swarm-glusterfs-va-giao-dien-quan-ly-swarmpit-ByEZkr0qKQ0", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O){return {data:[{post:{slug:u,title:"Triển khai docker swarm, glusterfs và giao diện quản lý swarmpit",publishedAt:"2021-08-11 00:52",authors:[{name:"Nham Van Hung",avatarUrl:"https:\u002F\u002Fimages.viblo.asia\u002Favatar\u002F41794475-ead7-4edd-9917-7d8d35dabdb5.jpg",link:"https:\u002F\u002Fviblo.asia\u002Fu\u002Fnham.van.hung"}],tags:["Docker","Docker swarm","Viblo"],private:false,source_post:"https:\u002F\u002Fviblo.asia\u002Fp\u002Ftrien-khai-docker-swarm-glusterfs-va-giao-dien-quan-ly-swarmpit-ByEZkr0qKQ0",toc:[{id:v,depth:n,text:w},{id:x,depth:n,text:y},{id:z,depth:n,text:A},{id:B,depth:n,text:C},{id:D,depth:n,text:E},{id:F,depth:n,text:G}],body:{type:"root",children:[{type:b,tag:o,props:{id:v},children:[{type:b,tag:m,props:{href:"#1-gi%E1%BB%9Bi-thi%E1%BB%87u-docker-swarm-glusterfs-swarmpit",ariaHidden:p,tabIndex:q},children:[{type:b,tag:r,props:{className:[s,t]},children:[]}]},{type:a,value:w}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Như các bạn đã biết Docker Swarm là công cụ native clustering cho Docker. Cho phép ta có thể gom một số Docker host lại\nvới nhau thành dạng cụm (cluster) và ta có xem nó như một máy chủ Docker ảo (virtual Docker host) duy nhất. ... Và Swarm\nmode cung cấp cho ta các tính năng để quản lý và điều phối cluster."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Glusterfs là gì?\nKhi các hệ thống lưu trữ ngày càng trở nên rộng lớn, thách thực được đặt ra là làm sao để nó vận hành được tối ưu và dễ\ndàng mở rộng thêm hơn nữa. Hãy tưởng tượng giờ ta có khoảng 10TB dung lượng lưu trữ trên một server storage, ở đó các\ncác client kết nối vào, tất cả các hoạt động đọc ghi được thực hiện trên server lưu trữ này. Giả sử đến một thời điểm\nnào đó, tất cả các hoạt động đọc ghi trên server storage này đều đã quá tải, ta lại có một server tương tự đã chuẩn bị\nsẵn. Vậy cách nào để ghép thêm server storage mới này vào hoạt động cùng server storage cũ và chia sẻ tải I\u002FO của nó. Đó\nlà lúc ta cần đến Glusterfs."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Còn về swarmpit là giao diện quản lý và vận hành cụm Docker Swarm.\nBây giờ mình sẽ giới thiệu đến các bạn sự kết hợp của 3 thằng này nhé."}]},{type:a,value:c},{type:b,tag:o,props:{id:x},children:[{type:b,tag:m,props:{href:"#2m%C3%B4i-tr%C6%B0%E1%BB%9Dng",ariaHidden:p,tabIndex:q},children:[{type:b,tag:r,props:{className:[s,t]},children:[]}]},{type:a,value:y}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Đầu tiên chúng ta cần chuẩn bị 3 server có thể kết nối local với nhau (Cùng chung 1 mạng nội bộ) và có dung lượng ổ cứng\ngiống nhau thì càng thuận lợi cho việc triển khai nhé.\n3 server của mình có IP local lần lượt là 10.20.12.5, 10.20.12.9, 10.20.12.10.\nMình dùng server có hệ điều hành là ubuntu 18.04.3"}]},{type:a,value:c},{type:b,tag:o,props:{id:z},children:[{type:b,tag:m,props:{href:"#3-c%C3%A0i-%C4%91%E1%BA%B7t-docker-swarm",ariaHidden:p,tabIndex:q},children:[{type:b,tag:r,props:{className:[s,t]},children:[]}]},{type:a,value:A}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Việc đầu tiên cần làm là cài đặt docker lên cả 3 server này:"}]},{type:a,value:c},{type:b,tag:e,props:{className:[f]},children:[{type:b,tag:g,props:{className:[h,i]},children:[{type:b,tag:j,props:{},children:[{type:a,value:"apt upgrade\napt install docker.io\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Sau đó chúng ta tạo docker swarm\nChúng ta sẽ chọn 1 server làm manager.\nTrên manager chúng ta chạy :"}]},{type:a,value:c},{type:b,tag:e,props:{className:[f]},children:[{type:b,tag:g,props:{className:[h,i]},children:[{type:b,tag:j,props:{},children:[{type:a,value:"docker swarm init --advertise-addr 10.20.12.5\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Lấy token để các node khác join swarm"}]},{type:a,value:c},{type:b,tag:e,props:{className:[f]},children:[{type:b,tag:g,props:{className:[h,i]},children:[{type:b,tag:j,props:{},children:[{type:a,value:"docker swarm join-token manager\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:k,props:{alt:l,src:"https:\u002F\u002Fres.cloudinary.com\u002Fdqibysfxu\u002Fimage\u002Fupload\u002Fv1628618650\u002Freiz-blog\u002F4341afde-ff04-4ba8-92b4-1fa88f0419a4.webp"},children:[]},{type:a,value:"\nJoin node vào swarm :"}]},{type:a,value:c},{type:b,tag:e,props:{className:[f]},children:[{type:b,tag:g,props:{className:[h,i]},children:[{type:b,tag:j,props:{},children:[{type:a,value:"docker swarm join --token SWMTKN-1-3vu5n3owvvrjycif60ywcf92wdoyu8exkb3r1t03ojd3cv2l97-52shxw6lj4pqw9auh6hkc1h3e\n10.20.12.5:2377\n\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Chúng ta đã hoàn thành việc cài đặt xong 1 khối docker swarm\n"},{type:b,tag:k,props:{alt:l,src:"https:\u002F\u002Fres.cloudinary.com\u002Fdqibysfxu\u002Fimage\u002Fupload\u002Fv1628618671\u002Freiz-blog\u002Fd4ec47eb-244e-485f-be21-42654c725492.webp"},children:[]}]},{type:a,value:c},{type:b,tag:o,props:{id:B},children:[{type:b,tag:m,props:{href:"#4-c%C3%A0i-%C4%91%E1%BA%B7t-swampit",ariaHidden:p,tabIndex:q},children:[{type:b,tag:r,props:{className:[s,t]},children:[]}]},{type:a,value:C}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Tiếp theo chúng ta cài đặt swarmpit trên 1 trong 3 server theo link : "},{type:b,tag:m,props:{href:H,rel:[I,J,K],target:L},children:[{type:a,value:H}]}]},{type:a,value:c},{type:b,tag:e,props:{className:[f]},children:[{type:b,tag:g,props:{className:[h,i]},children:[{type:b,tag:j,props:{},children:[{type:a,value:"docker run -it --rm \\\n--name swarmpit-installer \\\n--volume \u002Fvar\u002Frun\u002Fdocker.sock:\u002Fvar\u002Frun\u002Fdocker.sock \\\nswarmpit\u002Finstall:1.9\n\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Các bạn nhớ ghi lại user và password khi cái đặt swarmpit để có thể đăng nhập trên web để quản lý nhé."}]},{type:a,value:c},{type:b,tag:o,props:{id:D},children:[{type:b,tag:m,props:{href:"#5c%C3%A0i-%C4%91%E1%BA%B7t-glusterfs",ariaHidden:p,tabIndex:q},children:[{type:b,tag:r,props:{className:[s,t]},children:[]}]},{type:a,value:E}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Cấu hình file \u002Fetc\u002Fhost trên các server\nvi \u002Fetc\u002Fhost\n"},{type:b,tag:k,props:{alt:l,src:"https:\u002F\u002Fres.cloudinary.com\u002Fdqibysfxu\u002Fimage\u002Fupload\u002Fv1628619228\u002Freiz-blog\u002F0e30056d-eed8-4f8e-b026-e1ab698f0fcc.webp"},children:[]},{type:a,value:"\nCài đặt glusterfs"}]},{type:a,value:c},{type:b,tag:e,props:{className:[f]},children:[{type:b,tag:g,props:{className:[h,i]},children:[{type:b,tag:j,props:{},children:[{type:a,value:"apt install glusterfs-server glusterfs-common glusterfs-client -y\nsystemctl enable glusterd\nsystemctl start glusterd\n\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Cấu hình cluster"}]},{type:a,value:c},{type:b,tag:M,props:{},children:[{type:a,value:c},{type:b,tag:N,props:{},children:[{type:a,value:"Tại gluster01:"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:e,props:{className:[f]},children:[{type:b,tag:g,props:{className:[h,i]},children:[{type:b,tag:j,props:{},children:[{type:a,value:"gluster peer probe gluster02\ngluster peer probe gluster03\nKiểm tra:\ngluster peer status\n\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:k,props:{alt:l,src:"https:\u002F\u002Fimages.viblo.asia\u002F96a0e4b6-f09a-4453-a6e2-d645bebf5748.png"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Cấu hình storage\nTạo thư mục trên các node:"}]},{type:a,value:c},{type:b,tag:e,props:{className:[f]},children:[{type:b,tag:g,props:{className:[h,i]},children:[{type:b,tag:j,props:{},children:[{type:a,value:"mkdir -p \u002Fmnt\u002Fgfs-brick\n\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Tạo volume tên là data, tại gluster01:"}]},{type:a,value:c},{type:b,tag:e,props:{className:[f]},children:[{type:b,tag:g,props:{className:[h,i]},children:[{type:b,tag:j,props:{},children:[{type:a,value:"gluster volume create data replica 3 transport tcp gluster01:\u002Fmnt\u002Fgfs-brick gluster02:\u002Fmnt\u002Fgfs-brick\ngluster03:\u002Fmnt\u002Fgfs-brick force\ngluster volume status data\n\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Kiểm tra\ngluster volume status data\n"},{type:b,tag:k,props:{alt:l,src:"https:\u002F\u002Fimages.viblo.asia\u002Fcea43746-d2bc-4cda-aeae-bd93b0b0ffe0.png"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Tại gluster02 và gluster03:"}]},{type:a,value:c},{type:b,tag:e,props:{className:[f]},children:[{type:b,tag:g,props:{className:[h,i]},children:[{type:b,tag:j,props:{},children:[{type:a,value:"mkdir -p \u002Fmnt\u002Fdata\nmount -t glusterfs localhost:\u002Fdata \u002Fmnt\u002Fdata\ndf -h\numount \u002Fmnt\u002Fdata\n\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Tạo file trên gluster01, gluster02, gluster03:\nvi \u002Flib\u002Fsystemd\u002Fsystem\u002Fmnt-data.mount\n[Unit]\nDescription=GlusterFS mount\nRequires=glusterd.service\nAfter=glusterd.service"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"[Mount]\nWhat=localhost:\u002Fdata\nWhere=\u002Fmnt\u002Fdata\nType=glusterfs\nOptions=defaults,_netdev"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"[Install]\nWantedBy=multi-user.target"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:k,props:{alt:l,src:"https:\u002F\u002Fimages.viblo.asia\u002F22ea19ed-0c67-4743-b22c-e67315c95a63.png"},children:[]}]},{type:a,value:c},{type:b,tag:M,props:{},children:[{type:a,value:c},{type:b,tag:N,props:{},children:[{type:a,value:"Start mount data"}]},{type:a,value:c}]},{type:a,value:c},{type:b,tag:e,props:{className:[f]},children:[{type:b,tag:g,props:{className:[h,i]},children:[{type:b,tag:j,props:{},children:[{type:a,value:"systemctl daemon-reload\nsystemctl start mnt-data.mount\nsystemctl enable mnt-data.mount\n\n"}]}]}]},{type:a,value:c},{type:b,tag:o,props:{id:F},children:[{type:b,tag:m,props:{href:"#5ki%E1%BB%83m-tra-th%C3%A0nh-qu%E1%BA%A3",ariaHidden:p,tabIndex:q},children:[{type:b,tag:r,props:{className:[s,t]},children:[]}]},{type:a,value:G}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Chúng ta đã hoàn thành việc triển khai docker swarm và glusterfs. Có thể vào giao diện quản lý swarmpit để quản lý các\nnode và container.\nChúng ta mở trình duyệt và vào link :"},{type:b,tag:m,props:{href:O,rel:[I,J,K],target:L},children:[{type:a,value:O}]},{type:a,value:"\nipswarmpit là IP của server mà chúng ta đã cài swarmpit.\nGiao diện đăng nhập như sau:"}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:k,props:{alt:l,src:"https:\u002F\u002Fimages.viblo.asia\u002F75726650-fde3-456a-a4fa-381eb31bf2b2.png"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Tại đây chúng ta có thể kiểm tra các node hiện đang có trong swarm:\n"},{type:b,tag:k,props:{alt:l,src:"https:\u002F\u002Fimages.viblo.asia\u002Fee6c8aac-81d6-4e52-9625-30537e108d6a.png"},children:[]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Chúng ta cũng có thể triển khai các service hay container khác:\n"},{type:b,tag:k,props:{alt:l,src:"https:\u002F\u002Fimages.viblo.asia\u002Fec32d361-75b1-4a7f-bc13-8a3ccec50687.png"},children:[]},{type:b,tag:k,props:{alt:l,src:"https:\u002F\u002Fimages.viblo.asia\u002F5da54f74-e253-48b4-9b7d-a6f21c1fd299.png"},children:[]},{type:a,value:"\nMong rằng bài viết này sẽ hữu ích cho các bạn."}]}]},dir:"\u002F2021\u002Fviblo",path:"\u002F2021\u002Fviblo\u002Ftrien-khai-docker-swarm-glusterfs-va-giao-dien-quan-ly-swarmpit-ByEZkr0qKQ0",extension:".md",createdAt:"2021-08-10T17:36:19.842Z",updatedAt:"2021-08-10T18:14:00.109Z",readingTime:{text:"4 min read",minutes:3.585,time:215100,words:717},locale:"vi",slugWithoutLocale:u},slug:u,prev:{slug:"dung-nginx-tren-docker-swarm-va-script-de-tao-va-gia-han-ssl-tren-docker-swarm-eW65G4jPKDO",title:"Dùng Nginx trên docker swarm và script để tạo và gia hạn ssl trên docker swarm"},next:{slug:"nhat-ky-lam-he-thong-getlink-vip-fshare-trong-48h-m68Z07v6KkG",title:"Nhật ký làm hệ thống getLink vip Fshare trong 48h"}}],fetch:{},mutations:void 0}}("text","element","\n","p","div","nuxt-content-highlight","pre","language-text","line-numbers","code","img","image.png","a",3,"h3","true",-1,"span","icon","icon-link","trien-khai-docker-swarm-glusterfs-va-giao-dien-quan-ly-swarmpit-ByEZkr0qKQ0","1-giới-thiệu-docker-swarm-glusterfs-swarmpit","1. Giới thiệu Docker Swarm, Glusterfs, swarmpit.","2môi-trường","2.Môi trường","3-cài-đặt-docker-swarm","3. Cài đặt docker swarm","4-cài-đặt-swampit","4. Cài đặt swampit","5cài-đặt-glusterfs","5.Cài đặt glusterfs","5kiểm-tra-thành-quả","5.Kiểm tra thành quả","https:\u002F\u002Fswarmpit.io\u002F","nofollow","noopener","noreferrer","_blank","ul","li","http:\u002F\u002Fipswarmpit:888")));